#!/bin/bash

# This script updates your script files from the official
# GitHub repository using sparse-checkout (only 'install/scripts').

# Define the GitHub repository URL (replace with the actual one)
GIT_URL="https://github.com/thegamershollow/Unattended"

# Define the subdirectory to checkout
SPARSE_PATH="install/scripts"

# Define the destination directory
DEST_DIR="scripts"

# Move to the script's parent directory
cd "$(dirname "$0")"/..

# Check if Git is installed
if ! command -v git >/dev/null 2>&1; then
    echo "Error: Git is not installed or not in PATH."
    exit 1
fi

# If the destination directory exists and is a Git repo, pull updates
if [ -d "$DEST_DIR/.git" ]; then
    echo "Updating existing Git checkout in '$DEST_DIR'..."
    cd "$DEST_DIR"
    git pull
# If the destination exists but isn't a Git repo, back it up and clone fresh
elif [ -d "$DEST_DIR" ]; then
    echo "Directory '$DEST_DIR' exists but is not a Git repository."
    BACKUP_DIR="${DEST_DIR}_backup_$(date +%Y%m%d%H%M%S)"
    echo "Backing up existing directory to '$BACKUP_DIR'..."
    mv "$DEST_DIR" "$BACKUP_DIR"
fi

# If DEST_DIR doesn't exist or was just backed up, perform sparse checkout
if [ ! -d "$DEST_DIR" ]; then
    echo "Performing sparse checkout of '$SPARSE_PATH'..."
    mkdir "$DEST_DIR"
    cd "$DEST_DIR"
    git init
    git remote add origin "$GIT_URL"
    git config core.sparseCheckout true
    echo "$SPARSE_PATH/" > .git/info/sparse-checkout
    git pull origin main  # Replace 'main' with 'master' if needed
    mv "$SPARSE_PATH"/* .
    rm -rf "$SPARSE_PATH"
fi

echo "Update complete. Scripts are located in the '$DEST_DIR' directory."
